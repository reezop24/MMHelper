<!doctype html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin User Directory</title>
  <link rel="stylesheet" href="global.css" />
  <style>
    .content-card p {
      margin: 0;
      line-height: 1.55;
      color: #f0dde1;
      font-size: 14px;
    }

    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 14px;
    }

    .tab-btn {
      margin: 0;
      width: 100%;
      border: 1px solid #8d4d54;
      border-radius: 12px;
      padding: 10px 10px;
      background: rgba(56, 24, 29, 0.86);
      color: #f4e2e6;
      font-size: 13px;
      font-weight: 700;
      line-height: 1.2;
      text-align: center;
    }

    .tab-btn.active {
      background: linear-gradient(90deg, #f59e0b 0%, #f97316 100%);
      color: #2e1400;
      border-color: #f59e0b;
    }

    .meta {
      margin-top: 10px;
      color: #d8c1c6;
      font-size: 12px;
    }

    .user-list {
      margin-top: 10px;
      display: grid;
      gap: 10px;
    }

    .user-card {
      border: 1px solid #5a3035;
      border-radius: 12px;
      background: rgba(27, 18, 20, 0.92);
      padding: 11px 12px;
    }

    .user-name {
      margin: 0 0 7px;
      font-size: 15px;
      font-weight: 800;
      color: #ffeef1;
    }

    .line {
      margin: 3px 0;
      font-size: 13px;
      color: #f0dde1;
      line-height: 1.45;
    }

    .label {
      color: #d8c1c6;
      font-weight: 700;
      margin-right: 4px;
    }

    .empty {
      border: 1px dashed #8d4d54;
      border-radius: 12px;
      background: rgba(43, 18, 22, 0.8);
      color: #f0dde1;
      padding: 12px;
      text-align: center;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <main class="page">
    <div class="top-nav">
      <button id="backBtn" type="button" class="top-back-btn">← Back</button>
    </div>

    <header class="hero">
      <img class="logo" src="logo.png" alt="NEXTexclusive Logo" />
      <h1>User Directory</h1>
      <p>Admin Panel</p>
    </header>

    <section class="card content-card">
      <p>Senarai pengguna yang telah diluluskan mengikut kategori.</p>

      <div class="tabs">
        <button id="tabNext" type="button" class="tab-btn active">Next Member</button>
        <button id="tabEvideo" type="button" class="tab-btn">Evideo Subscriber</button>
      </div>

      <p id="meta" class="meta">Loading data...</p>
      <section id="list" class="user-list"></section>
    </section>
  </main>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    (function () {
      var tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
      if (tg) {
        tg.ready();
        tg.expand();
      }

      var tabNext = document.getElementById("tabNext");
      var tabEvideo = document.getElementById("tabEvideo");
      var metaEl = document.getElementById("meta");
      var listEl = document.getElementById("list");
      var backBtn = document.getElementById("backBtn");
      var active = "next_member";

      function parsePayload() {
        try {
          var raw = new URLSearchParams(window.location.search).get("admin_users_payload");
          if (!raw) return { next_member: [], evideo_subscriber: [] };
          var parsed = JSON.parse(raw);
          if (!parsed || typeof parsed !== "object") return { next_member: [], evideo_subscriber: [] };
          return {
            next_member: Array.isArray(parsed.next_member) ? parsed.next_member : [],
            evideo_subscriber: Array.isArray(parsed.evideo_subscriber) ? parsed.evideo_subscriber : []
          };
        } catch (e) {
          return { next_member: [], evideo_subscriber: [] };
        }
      }

      var data = parsePayload();

      function buildCard(item) {
        var username = item.telegram_username ? "@" + item.telegram_username : "-";
        return (
          '<article class="user-card">' +
            '<p class="user-name">' + (item.name || "-") + "</p>" +
            '<p class="line"><span class="label">Telegram:</span>' + username + "</p>" +
            '<p class="line"><span class="label">User ID:</span>' + (item.user_id || "-") + "</p>" +
            '<p class="line"><span class="label">Tarikh Pengesahan:</span>' + (item.verification_date || "-") + "</p>" +
            '<p class="line"><span class="label">Tarikh Approval:</span>' + (item.approval_date || "-") + "</p>" +
          "</article>"
        );
      }

      function render() {
        var arr = active === "next_member" ? data.next_member : data.evideo_subscriber;
        var label = active === "next_member" ? "Next Member" : "Evideo Subscriber";
        tabNext.classList.toggle("active", active === "next_member");
        tabEvideo.classList.toggle("active", active === "evideo_subscriber");
        metaEl.textContent = label + " • " + arr.length + " user";
        if (!arr.length) {
          listEl.innerHTML = '<div class="empty">Tiada user dalam kategori ini.</div>';
          return;
        }
        var html = "";
        for (var i = 0; i < arr.length; i += 1) html += buildCard(arr[i] || {});
        listEl.innerHTML = html;
      }

      function backToMainMenu() {
        var payload = { type: "sidebot_back_to_main_menu" };
        if (tg) {
          tg.sendData(JSON.stringify(payload));
          tg.close();
          return;
        }
        window.history.back();
      }

      tabNext.addEventListener("click", function () { active = "next_member"; render(); });
      tabEvideo.addEventListener("click", function () { active = "evideo_subscriber"; render(); });
      backBtn.addEventListener("click", backToMainMenu);
      render();
    })();
  </script>
</body>
</html>
